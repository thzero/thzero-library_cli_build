<script type="text/javascript">
    RED.nodes.registerType('build-event-start', {
        category: 'function',
        color: '#a6bbcf',
        defaults: {
            name: { value: '' }
        },
        inputs: 0,
        outputs: 1,
        icon: 'font-awesome/fa-message',
        label: function() {
            return this.name || 'build-event-start';
        }
    });

    function test(customMsg) {
        try {
            const node = this; // TODO: not
            RED.notify('Starting test...');
            $.ajax({
                url: 'build/start',
                type: 'POST',
                data: JSON.stringify(customMsg || {}),
                contentType: 'application/json; charset=utf-8',
                success: function (resp) {
                    RED.notify(node._('inject.success', null), { type: 'success', id: 'inject', timeout: 2000 });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    if (jqXHR.status == 404) {
                        RED.notify(node._('common.notification.error', { message: node._('common.notification.errors.not-deployed') }), 'error');
                    } else if (jqXHR.status == 500) {
                        RED.notify(node._('common.notification.error', { message: node._('inject.errors.failed') }), 'error');
                    } else if (jqXHR.status == 0) {
                        RED.notify(node._('common.notification.error', { message: node._('common.notification.errors.no-response') }), 'error');
                    } else {
                        RED.notify(node._('common.notification.error', { message: node._('common.notification.errors.unexpected', { status: jqXHR.status, message: textStatus }) }), 'error');
                    }
                }
            });
        }
        catch (err) {
            console.log(err);
        }
    }
</script>

<script type="text/html" data-template-name="build-event-start">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row node-input-property-container-row">
        <button onclick="test()">Test</button>
    </div>
</script>

<script type="text/html" data-help-name="build-event-start">
    <p>Listen to the build start event from the internal Red.events emitter.</p>
</script>